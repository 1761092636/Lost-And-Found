<!DOCTYPE html>
<html class="wide wow-animation" lang="en">
  <head>
    <title>callme</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,400;0,500;0,700;0,900;1,700&display=swap">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/checkout.css">
    <link rel="stylesheet" href="css/back.css">
    <link rel="stylesheet" type="text/css" href="css/mdialog.css">
  </head>
  <body>
    <div class="preloader">
      <div class="preloader-body">
        <div class="cssload-container">
          <div class="cssload-speeding-wheel"></div>
        </div>
      </div>
    </div>
    <div class="page">
      <header class="section page-header">
        <!--RD Navbar-->
        <div class="rd-navbar-wrap">
          <nav class="rd-navbar rd-navbar-classic" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-fixed" data-xl-layout="rd-navbar-static" data-xxl-layout="rd-navbar-static" data-md-device-layout="rd-navbar-fixed" data-lg-device-layout="rd-navbar-fixed" data-xl-device-layout="rd-navbar-static" data-xxl-device-layout="rd-navbar-static" data-xl-stick-up-offset="3px" data-xxl-stick-up-offset="3px" data-xl-stick-up="true" data-xxl-stick-up="true">
            <div class="rd-navbar-main-outer">
              <div class="rd-navbar-main">
                <div class="rd-navbar-main-col">
                  <!--RD Navbar Panel-->
                  <div class="rd-navbar-panel">
                    <!--RD Navbar Toggle-->
                    <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>



                     <!--RD Navbar Brand-->
                    <div class="rd-navbar-brand">
                      <!--Brand--><a class="brand" href="index.html"><img class="brand-logo-dark" src="images/logo1.PNG" alt="" width="103" height="34" loading="lazy"/><img class="brand-logo-light" src="images/logo1.PNG" alt="" width="103" height="34" loading="lazy"/></a>
                    </div>
                  </div>
                </div>
               
                    <div class="rd-navbar-main-col">
                            <div class="rd-navbar-main-element">
                                <div class="rd-navbar-nav-wrap">
                                    <ul class="rd-navbar-nav">
                                        <li class="rd-nav-item"><a class="rd-nav-link" href="index.html">首页</a></li>
                                        <li class="rd-nav-item"><a class="rd-nav-link" href="#">招领中心</a>
                                            <ul class="rd-menu rd-navbar-dropdown">
                                                <li class="rd-dropdown-item "><a class="rd-dropdown-link"
                                                        href="lost.html">我是拾主</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="found.html">我是失主</a></li>
                                            </ul>
                                        </li>
                                        <li class="rd-nav-item "><a class="rd-nav-link" href="track.html">安心溯源</a>
                                        </li>
                                        <li class="rd-nav-item"><a class="rd-nav-link" href="rank.html">排行榜</a>
                                        </li>
                                        <li class="rd-nav-item"><a class="rd-nav-link"
                                                href="history.html">操作记录</a>
                                            <ul class="rd-menu rd-navbar-dropdown">
                                                <li class="rd-dropdown-item "><a class="rd-dropdown-link"
                                                        href="history-my.html">我的操作记录</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="history.html">操作记录公开</a>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="rd-nav-item"><a class="rd-nav-link" href="#">用户中心</a>
                                            <ul class="rd-menu rd-navbar-dropdown">
                                                <li class="rd-dropdown-item "><a class="rd-dropdown-link"
                                                        href="login.html">用户登陆</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="register.html">用户注册</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="LostItemAdd.html">上报个人失物</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="mylost.html">我的失物管理</a></li>
                                                <li class="rd-dropdown-item"><a class="rd-dropdown-link"
                                                        href="application.html">我的失物申请</a></li>
                                            </ul>
                                        </li>
                                       
                                    </ul>
                                </div>
                            </div>
                        </div>

                        
                <div class="rd-navbar-main-col">
                  <div class="rd-navbar-widgets rd-navbar-fixed-element">
                    <!--RD Navbar Search-->
                    <div class="rd-navbar-search">
                      
                      <div class="rd-navbar-search-modal">
                        <form class="rd-search" action="search-results.html" data-search-live="rd-search-results-live" method="GET">
                          <div class="h2 rd-navbar-fixed--hidden">What are you looking for?</div>
                          <div class="form-wrap">
                            <label class="form-label" for="rd-navbar-search-form-input">Search this store</label>
                            <input class="rd-navbar-search-form-input form-input" id="rd-navbar-search-form-input" type="text" name="s" autocomplete="off">
                            <button class="rd-search-form-submit" type="submit">
                              <svg class="svg-fill" width="24" height="25" viewBox="0 0 24 25">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M10.961 17.9605C15.1811 17.9605 18.6022 14.476 18.6022 10.1776C18.6022 5.87924 15.1811 2.39473 10.961 2.39473C6.74094 2.39473 3.31988 5.87924 3.31988 10.1776C3.31988 14.476 6.74094 17.9605 10.961 17.9605ZM10.961 20.3552C16.4796 20.3552 20.9533 15.7985 20.9533 10.1776C20.9533 4.55666 16.4796 0 10.961 0C5.44245 0 0.96875 4.55666 0.96875 10.1776C0.96875 15.7985 5.44245 20.3552 10.961 20.3552Z"></path>
                                <path d="M16.0215 17.9692L17.875 16.2874L23.6543 22.8949C24.1103 23.4162 24.065 24.2153 23.5532 24.6797C23.0414 25.1442 22.2568 25.098 21.8008 24.5767L16.0215 17.9692Z"></path>
                              </svg>
                            </button>
                          </div>
                          <div class="rd-search-results-live" id="rd-search-results-live"></div>
                        </form>
                      </div>
                    </div>
                    <!--RD Navbar cart-->
                    <div class="rd-navbar-cart-wrap">
                      <button  id="user_now">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                          <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                        </svg>
                      </button>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>
      <div class="kele" onclick="window.history.back();">返回</div>
      <section class="section section-md" >
        <div class="container">
            <div class="row row-50">
        <div class="col-lg-8" id="personal">

              </div>

         <div class="col-lg-4">
                <div class="ps-xl-50">
                  <h2>联系人</h2>
                  <div class="row row-30">
                    <div class="col-lg-12 col-sm-6">
                      <h3 class="mb-10">地址:</h3>
                      <div class="big"><a class="link-gray-800" href="#">江西南昌
                          <br> 江西软件职业技术大学</a></div>
                    </div>
                    <div class="col-lg-12 col-sm-6">
                      <h3 class="mb-10">Phones:</h3>
                      <div class="big"><a class="link-gray-800" href="">18279852132</a></div>
                      <div class="big mt-0"><a class="link-gray-800" href="">1888866669</a></div>
                    </div>
                    
                  
                  </div>
                </div>
              </div>
        </div>
       </div>
          
      </section>
      
      <section class="section section-md" >
        
         <div class="container">
          <h2 >该用户其他失物</h2>
        <div class="row row-50" id="callitem"></div>
        </div>
      </section>
      

    </div>
    <div class="snackbars" id="form-output-global">
      
    </div>





  </body>
</html>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/submitapp.js"></script>
<script >
var points;

function getAddressFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('address');
}

$(document).ready(function () {

    const myaddress = getAddressFromURL();
    if (myaddress) {
        console.log(myaddress)
        getAndRenderUserInfo(myaddress);
        getAndRenderLostItems(myaddress)
    } else {
        console.error("Address parameter is missing");
    }
});

// 获取用户积分
function getpoints(address, callback) {
    $.ajax({
        "type": "POST",
        "url": "http://127.0.0.1:9526/router/GetUserPoints",
        xhrFields: {
            withCredentials: true // 允许携带凭证  
        },
        crossDomain: true, // 允许跨域请求 
        data: JSON.stringify({ "address": address }),
        "success": function (data) {
            callback(data.data); // 调用回调函数并传递数据
        },
        "error": function (error) {
            console.error("Failed to get user points:", error);
            callback(null); // 如果请求失败，则传递null给回调函数
        }
    })
}

// 获取并渲染用户信息
function getAndRenderUserInfo(address) {
    $.ajax({
        "type": "GET",
        "url": "http://127.0.0.1:9526/router/GetUserByAddress",
        xhrFields: {
            withCredentials: true // 允许携带凭证  
        },
        crossDomain: true, // 允许跨域请求  
        data: { "address": address },
        "success": function (data) {
          console.log(data)
            // 成功获取用户数据后，调用getpoints函数并传入回调函数
            getpoints(address, function (pointsData) {
                // 在回调函数中处理获取到的pointsData
                console.log(pointsData);
                points = pointsData; // 将数据赋值给全局变量
                renderUserInfo(data, pointsData); // 渲染用户信息页面
            });
            // 其他逻辑...
        },
        "error": function (error) {
            console.error("Failed to get user info:", error);
            // 处理获取用户信息失败的情况
        }
    });
}

// 渲染用户信息页面
function renderUserInfo(userInfo, pointsData) {
  console.log(userInfo)
    $("#personal").append(`
        
                <div class="col-lg-8">
                    <h2>个人中心</h2>
                    <div class="row row-30 align-items-end">
                        <div class="col-md-6">
                            <label class="form-label form-label-outside" for="contact-name">用户名</label>
                            <div class="form-wrap">
                                <input class="form-input" id="contact-name" type="text" name="First-name" readonly="readonly" value="${userInfo.data.user_name}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label form-label-outside" for="contact-email">账户地址</label>
                            <div class="form-wrap">
                                <input class="form-input" id="contact-email" type="text" name="adress"  readonly="readonly" value="${userInfo.data.address}">
                            </div>
                        </div>
                  
                     
                        <div class="col-md-6">
                            <label class="form-label form-label-outside" for="contact-email">电话</label>
                            <div class="form-wrap">
                                <input class="form-input" id="contact-email" type="text" name="adress"  readonly="readonly" value="${userInfo.data.phone}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label form-label-outside" for="contact-email">用户积分</label>
                            <div class="form-wrap">
                                <input class="form-input" id="contact-email" type="text" name="adress"  readonly="readonly" value="${pointsData}">
                            </div>
                        </div>
                     
                    </div>
                </div>
       
    `);
}

// 查询失物信息并渲染
function getAndRenderLostItems(address) {
    // 这里调用查询失物信息的函数，然后根据返回的失物数据进行渲染
    $.ajax({
        "type": "GET",
        "url": "http://127.0.0.1:9526/router/GetLostItemByAddress",
         xhrFields: {
            withCredentials: true // 允许携带凭证  
        },
        crossDomain: true, // 允许跨域请求
        data: { "myuser": address },
        "success": function (data) {
          console.log(address)
            console.log("Lost Items:", data);
            // 这里可以根据返回的失物数据进行渲染
            // 例如：
            renderLostItems(data);
        },
        "error": function (error) {
            console.error("Failed to get lost items:", error);
            // 处理获取失物信息失败的情况
        }
    });
}

// 渲染失物信息
function renderLostItems(lostItems) {
    // 这里根据失物数据进行渲染
    // 例如：
    lostItems.data.forEach(function (item) {
      console.log(item)
        // 渲染单个失物信息
        $("#callitem").append(`
           <div class="col-sm-6 col-lg-4">
            <article class="product-classic" data-id="${item.lostItemId}">
                <div class="product-classic-header">
                    <figure class="product-classic-figure"><img src="${item.lostimg}" alt="${item.lostItemName}" width="270" height="200" loading="lazy"/></figure>
                    <div class="product-classic-cart"><a class="btn-cart" onclick="buy()">
                        <svg class="svg-fill" width="22" height="21">
                            <path d="M18.4141 6.76467L15.2899 0L14.0465 0.57426L16.9055 6.76467H6.03205L8.891 0.57426L7.64761 0L4.52341 6.76467H0.96875V11.6972H2.6111L4.2911 20.1385H18.6465L20.3265 11.6972H21.9688V6.76467H18.4141ZM17.5226 18.769H5.41493L4.00752 11.6971H18.93L17.5226 18.769ZM20.5992 10.3276H2.3383V8.13422H20.5992L20.5992 10.3276Z"></path>
                            <path d="M7.54916 12.7688L6.20582 13.0361L7.13263 17.693L8.47597 17.4256L7.54916 12.7688Z"></path>
                            <path d="M12.3033 12.8562H10.9337V17.6036H12.3033V12.8562Z"></path>
                            <path d="M15.6513 12.7685L14.7244 17.4254L16.0677 17.6927L16.9945 13.0359L15.6513 12.7685Z"></path>
                        </svg></a>
                    </div>
                </div>
                <div class="product-classic-body">
                    <div><input id="lostItemId" type="hidden" value="${item.lostItemId}"></div>
                    <h5 class="product-classic-title"><a href="single-product.html"><input id="lostItemName" type="hidden" value="${item.lostItemName}">#${item.lostItemId} ${item.lostItemName}</a></h5>
                    <div class="product-classic-text">${item.description}</div>
                    <div class="product-classic-price price">
                        <div class="price-current" ><input type="hidden" id="reward" value="${item.reward}">$${item.reward}Wei</div>
                    </div>      
                   
                    <button type="submit" class="btn" onclick="buy()" style="background-color: #8EB360"><h4>上报拾得<h4></button>
                </div>
            </article>
        </div>
        `);
    });
}
</script>
<script>



</script>
<script type="text/javascript" src="footer.js"></script>
<script src="js/checkout.js"></script>
<script src="js/core.min.js"></script>
<script src="js/script.js"></script>
<script src="js/user_now.js"></script>
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/mdialog.js"></script>


